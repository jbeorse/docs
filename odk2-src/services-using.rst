Using ODK Services
====================

.. _services-using:

.. _services-using-initial-config:

Initial Server Configuration
-----------------------------------
Before you are able to synchronize your data or application files, you will need to configure your server settings. Instructions are provided in the :ref:`deployment architect guide <services-setup-server-config>`.

.. _services-using-change-user:

Authenticating Users
----------------------
To log in or change the authenticated user, launch Services and open the user authentication screen. There are two ways to do this:

  Option 1: Press the Action Button (:guilabel:`â‹®`) and select :menuselection:`Change User/Logout`

    .. image:: /img/services-using/services-options-change.*
      :alt: Services Change User Option
      :class: device-screen-vertical

  Option 2: From within the Sync screen, press the :guilabel:`Change User` button.


    .. image:: /img/services-using/services-sync.*
      :alt: Sync Screen
      :class: device-screen-vertical

You will see the user authentication screen.


  .. image:: /img/services-using/services-user-auth.*
    :alt: User Authentication Screen
    :class: device-screen-vertical

Within this page you can enter a new :guilabel:`username` and :guilabel:`password` and click the :guilabel:`Authenticate New User` button to contact the Cloud Endpoint and log in as this new user.

.. note::

  To authenticate a new user, you must have a network connection and have the Server URL set appropriately. See the :ref:`deployment architect guide <services-setup-server-config>` for instructions on how to set this.

If you want to log out of your current user without logging into a new user, click the :guilabel:`Log Out` button. This does not require a network connection.

.. _services-using-sync:

Syncing
---------------

Use this option to submit your data and download the latest updates from the server. When this process is finished, the data on your device and the server will match. You will also receive any updates to your application that your Deployment Architect might have made.

There are two ways to launch the Sync screen.

  Option 1: Launch Services. Click the :guilabel:`Sync` icon that looks like two arrows circling each other.

    .. image:: /img/services-using/services-homescreen-sync.*
      :alt: Services Sync Button
      :class: device-screen-vertical

  Option 2: From within Survey or Tables click the :guilabel:`Sync` icon (same as above). This will launch Services to the Sync screen. Below this is shown in ODK Survey.


    .. image:: /img/services-using/survey-homescreen-sync.*
      :alt: Survey Sync Button
      :class: device-screen-vertical

You will then see the Sync screen.

  .. image:: /img/services-using/services-sync.*
    :alt: Sync Screen
    :class: device-screen-vertical

Before syncing, you should verify all options are set correctly.

  1. The username can be be changed by pressing the :guilabel:`Change User` button. Instructions are provided in the :ref:`services-using-change-user` section.

    .. warning::

      If you authenticate as a different user after modifying data in the database, you could lose changes. Each user can have their own set of permissions to read, write, and delete different portions of the database. If you switch from one set of permissions to another, changes to areas that the new user is not allowed to modify may be lost.

      To prevent this be sure to synchronize all changes before authenticating new users.

  2. The sync interaction has four options for managing file attachments. These are offered if bandwidth or storage is a concern:

    - :menuselection:`Fully Sync Attachments` - *Default* - Synchronize all file attachments with the server.
    - :menuselection:`Upload Attachments Only` - Only upload attachments from the device to the server.
    - :menuselection:`Download Attachments Only` - Only download attachments from the server to the device.
    - :menuselection:`Do Not Sync Attachments` -  Do not sync any attachments.

  .. note::

    All four of the attachment options will fully synchronize your database. This includes all completed forms and collected data.

When you are ready to sync you data click on :guilabel:`Sync Now`.

Services will contact the Cloud Endpoint and synchronize your data. A progress dialog will be displayed and, alternatively, the status of sync can be obtained by looking at the notifications generated by Services in the notification area.

.. note::

  The sync will proceed whether or not you remain on this page and you can use the back button to back out of it and return to your work.

.. warning::

  Should you begin modifying data rows while syncing, the changes to those rows will not be synced until you save them as incomplete or finalize the row, and the act of editing will generally mark the sync as having ended with conflicts. This means that you must complete your edits and re-issue the sync to ensure that your changes are propagated up to the server.


.. _services-using-resolve:

Resolving Sync Conflicts
---------------------------------------

When you return from ODK Services and next access data, the ODK 2.0 tools will scan all tables looking for conflicts arising from the synchronization process. If any conflicts are found, you are required to resolve the conflict before proceeding to your activity. The options for resolving conflicts are as follows.

  - :guilabel:`Take Local Version` - Use the version on the device, deleting the server version.
  - :guilabel:`Take Server Version` - Use the server version, deleting the version that is on the device.
  - :guilabel:`Merge Changes` - Will be enabled once all conflicts in the row's data fields have been decided.

Choose the desired option. Once the changes are reconciled, you can then proceed to the activity you were accessing and, when you next sync, the resolved conflicts and any new changes will be pushed up to the server. Then, other users will receive those changes when they sync to the server.
